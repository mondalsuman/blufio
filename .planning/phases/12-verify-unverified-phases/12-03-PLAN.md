---
phase: 12-verify-unverified-phases
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/06-model-routing-smart-heartbeats/06-01-SUMMARY.md
  - .planning/phases/06-model-routing-smart-heartbeats/06-02-SUMMARY.md
  - .planning/phases/06-model-routing-smart-heartbeats/06-03-SUMMARY.md
  - .planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md
autonomous: true
requirements:
  - LLM-06

must_haves:
  truths:
    - "06-VERIFICATION.md exists with top-level verdict and SC-1 through SC-2 verification"
    - "06-01-SUMMARY.md, 06-02-SUMMARY.md, and 06-03-SUMMARY.md exist as retroactive summaries with 'Retroactive: created during Phase 12 verification' marker"
    - "Each SC traces to specific files, functions, and code evidence"
    - "Requirements coverage table maps LLM-06 (LLM-05 handled by Phase 11)"
    - "Retroactive summaries follow existing SUMMARY format from other phases"
  artifacts:
    - path: ".planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md"
      provides: "Phase 6 formal verification document"
      contains: "Phase Status:"
    - path: ".planning/phases/06-model-routing-smart-heartbeats/06-01-SUMMARY.md"
      provides: "Retroactive execution summary for plan 06-01"
      contains: "Retroactive"
    - path: ".planning/phases/06-model-routing-smart-heartbeats/06-02-SUMMARY.md"
      provides: "Retroactive execution summary for plan 06-02"
      contains: "Retroactive"
    - path: ".planning/phases/06-model-routing-smart-heartbeats/06-03-SUMMARY.md"
      provides: "Retroactive execution summary for plan 06-03"
      contains: "Retroactive"
---

<objective>
Create VERIFICATION.md for Phase 6 (Model Routing & Smart Heartbeats) and retroactive SUMMARY files for all 3 plans (06-01, 06-02, 06-03). Trace the LLM-06 requirement through the codebase and verify each success criterion.

Purpose: Phase 6 has been complete since 2026-03-01 but lacks formal verification and all execution summaries. This document confirms model routing and heartbeat requirements are satisfied.

Output: `06-VERIFICATION.md`, `06-01-SUMMARY.md`, `06-02-SUMMARY.md`, `06-03-SUMMARY.md`
</objective>

<execution_context>
@/Users/suman/.claude/get-shit-done/workflows/execute-plan.md
@/Users/suman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/06-model-routing-smart-heartbeats/06-01-PLAN.md
@.planning/phases/06-model-routing-smart-heartbeats/06-02-PLAN.md
@.planning/phases/06-model-routing-smart-heartbeats/06-03-PLAN.md
@.planning/phases/11-fix-integration-bugs/11-VERIFICATION.md

<interfaces>
Phase 6 Success Criteria (from ROADMAP.md):
  SC-1: Simple queries ("what time is it?", "hi") are routed to Haiku, standard queries to Sonnet, and complex multi-step reasoning queries to Opus -- verifiable via cost ledger model attribution
  SC-2: Smart heartbeats run on Haiku with skip-when-unchanged logic, costing no more than $10/month for always-on operation

Phase 6 Requirements: LLM-05 (handled by Phase 11), LLM-06
Note: Only LLM-06 is in scope for this verification. LLM-05 was verified in Phase 11's VERIFICATION.md.

Key source files to trace:
  - crates/blufio-router/src/classifier.rs (QueryClassifier -- heuristic complexity classification)
  - crates/blufio-router/src/router.rs (ModelRouter -- budget-aware model selection)
  - crates/blufio-router/src/heartbeat.rs (HeartbeatRunner -- background proactive check-ins)
  - crates/blufio-router/src/lib.rs (public API)
  - crates/blufio-agent/src/session.rs (routing integration in agent loop)
  - crates/blufio/src/serve.rs (heartbeat spawn on startup)

Reference format: Phase 11 VERIFICATION.md, any existing SUMMARY.md from other phases
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create retroactive SUMMARY files for plans 06-01, 06-02, 06-03</name>
  <files>
    .planning/phases/06-model-routing-smart-heartbeats/06-01-SUMMARY.md,
    .planning/phases/06-model-routing-smart-heartbeats/06-02-SUMMARY.md,
    .planning/phases/06-model-routing-smart-heartbeats/06-03-SUMMARY.md
  </files>
  <action>
Read all 3 plan files (06-01-PLAN.md, 06-02-PLAN.md, 06-03-PLAN.md) and a reference SUMMARY from another phase (e.g., 05-03-SUMMARY.md or any existing one).

Then read the actual source files listed in each plan's `files_modified` to understand what was actually built.

**For each of the 3 summaries:**
- Read the plan's files_modified source files
- Write retroactive summary matching the standard format
- Include "**Retroactive: created during Phase 12 verification**" after the title
- Set commit field to "retroactive" in frontmatter
- Honestly reflect what was built vs what was planned

**06-01-SUMMARY.md:** blufio-router crate: QueryClassifier, ModelRouter, RoutingConfig, HeartbeatConfig, CostRecord intended_model, V4 migration
**06-02-SUMMARY.md:** HeartbeatRunner: background check-ins on Haiku, skip-when-unchanged, dedicated budget, delivery modes
**06-03-SUMMARY.md:** Integration wiring: SessionActor routing, serve.rs heartbeat spawn, budget downgrade notifications
  </action>
  <verify>
    <automated>cd /Users/suman/projects/github/blufio && test -f .planning/phases/06-model-routing-smart-heartbeats/06-01-SUMMARY.md && test -f .planning/phases/06-model-routing-smart-heartbeats/06-02-SUMMARY.md && test -f .planning/phases/06-model-routing-smart-heartbeats/06-03-SUMMARY.md && grep -l "Retroactive" .planning/phases/06-model-routing-smart-heartbeats/06-*-SUMMARY.md | wc -l</automated>
  </verify>
  <done>
    - All 3 SUMMARY files exist with retroactive markers
    - Each follows the standard SUMMARY format
    - Proper YAML frontmatter (phase, plan, type, status, commit: retroactive)
    - Content honestly reflects what was built
  </done>
</task>

<task type="auto">
  <name>Task 2: Deep code trace and write 06-VERIFICATION.md</name>
  <files>
    .planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md
  </files>
  <action>
Read and trace through the Phase 6 source files to verify SC-1 and SC-2:

**SC-1 (Query complexity routing):**
- Read `crates/blufio-router/src/classifier.rs` -- verify QueryClassifier classifies queries by complexity
- Read `crates/blufio-router/src/router.rs` -- verify ModelRouter routes to Haiku/Sonnet/Opus based on classification
- Read `crates/blufio-agent/src/session.rs` -- verify SessionActor uses routing decision for each message
- Check that cost ledger records the intended model for attribution

**SC-2 (Smart heartbeats on Haiku, <=$10/month):**
- Read `crates/blufio-router/src/heartbeat.rs` -- verify HeartbeatRunner
- Check for skip-when-unchanged logic (only sends heartbeat when session state has changed)
- Check for dedicated $10/month budget allocation
- Verify heartbeats use Haiku model specifically
- Read `crates/blufio/src/serve.rs` -- verify heartbeat is spawned on startup

Run `cargo check --workspace` and `cargo test --workspace` for build verification.

**Write 06-VERIFICATION.md** following Phase 11 format with:
- Top-level verdict
- SC-1 and SC-2 with code evidence
- Build verification section
- Requirements coverage table (LLM-06 only; note that LLM-05 is covered by Phase 11)
  </action>
  <verify>
    <automated>cd /Users/suman/projects/github/blufio && test -f .planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md && grep -c "SC-" .planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md</automated>
  </verify>
  <done>
    - 06-VERIFICATION.md created with SC-1 and SC-2 verified
    - Top-level verdict present
    - Each SC has specific code evidence
    - Build verification section with results
    - Requirements coverage table maps LLM-06
    - Note about LLM-05 being covered by Phase 11
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. All 3 retroactive SUMMARY files exist with markers
2. `06-VERIFICATION.md` exists and follows Phase 11 format
3. Both success criteria have evidence blocks
4. LLM-06 appears in requirements coverage table

```bash
cd /Users/suman/projects/github/blufio && ls .planning/phases/06-model-routing-smart-heartbeats/06-*SUMMARY.md .planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md && grep "Phase Status:" .planning/phases/06-model-routing-smart-heartbeats/06-VERIFICATION.md
```
</verification>

<success_criteria>
- All 3 retroactive SUMMARYs created with markers
- 06-VERIFICATION.md follows Phase 11 format
- SC-1 and SC-2 verified with code evidence
- LLM-06 mapped in coverage table
- Build verification section current
</success_criteria>

<output>
After completion, create `.planning/phases/12-verify-unverified-phases/12-03-SUMMARY.md`
</output>
